{"ast":null,"code":"import _regeneratorRuntime from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import{API,Storage}from\"aws-amplify\";import{onError}from\"../libs/errorLib\";import Form from\"react-bootstrap/Form\";import LoaderButton from\"../components/LoaderButton\";import config from\"../config\";import\"./Notes.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Notes(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isDeleting=_useState4[0],setIsDeleting=_useState4[1];var file=useRef(null);var _useParams=useParams(),id=_useParams.id;var history=useHistory();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),note=_useState6[0],setNote=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),content=_useState8[0],setContent=_useState8[1];useEffect(function(){function loadNote(){return API.get(\"notes\",\"/notes/\".concat(id));}function onLoad(){return _onLoad.apply(this,arguments);}function _onLoad(){_onLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _note,_content,attachment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return loadNote();case 3:_note=_context.sent;_content=_note.content,attachment=_note.attachment;if(!attachment){_context.next=9;break;}_context.next=8;return Storage.vault.get(attachment);case 8:_note.attachmentURL=_context.sent;case 9:setContent(_content);setNote(_note);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);onError(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return _onLoad.apply(this,arguments);}onLoad();},[id]);function validateForm(){return content.length>0;}function formatFilename(str){return str.replace(/^\\w+-/,\"\");}function handleFileChange(event){file.current=event.target.files[0];}function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var attachment;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();if(!(file.current&&file.current.size>config.MAX_ATTACHMENT_SIZE)){_context2.next=4;break;}alert(\"Please pick a file smaller than \".concat(config.MAX_ATTACHMENT_SIZE/1000000,\" MB.\"));return _context2.abrupt(\"return\");case 4:setIsLoading(true);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _handleSubmit.apply(this,arguments);}function handleDelete(_x2){return _handleDelete.apply(this,arguments);}function _handleDelete(){_handleDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var confirmed;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:event.preventDefault();confirmed=window.confirm(\"Are you sure you want to delete this note?\");if(confirmed){_context3.next=4;break;}return _context3.abrupt(\"return\");case 4:setIsDeleting(true);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _handleDelete.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"Notes\",children:note&&/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Group,{controlId:\"content\",children:/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",value:content,onChange:function onChange(e){return setContent(e.target.value);}})}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"file\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Attachment\"}),note.attachment&&/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"a\",{target:\"_blank\",rel:\"noopener noreferrer\",href:note.attachmentURL,children:formatFilename(note.attachment)})}),/*#__PURE__*/_jsx(Form.Control,{onChange:handleFileChange,type:\"file\"})]}),/*#__PURE__*/_jsx(LoaderButton,{block:true,size:\"lg\",type:\"submit\",isLoading:isLoading,disabled:!validateForm(),children:\"Save\"}),/*#__PURE__*/_jsx(LoaderButton,{block:true,size:\"lg\",variant:\"danger\",onClick:handleDelete,isLoading:isDeleting,children:\"Delete\"})]})});}","map":{"version":3,"sources":["/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/src/containers/Notes.js"],"names":["React","useRef","useState","useEffect","useParams","useHistory","API","Storage","onError","Form","LoaderButton","config","Notes","isLoading","setIsLoading","isDeleting","setIsDeleting","file","id","history","note","setNote","content","setContent","loadNote","get","onLoad","attachment","vault","attachmentURL","validateForm","length","formatFilename","str","replace","handleFileChange","event","current","target","files","handleSubmit","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","handleDelete","confirmed","window","confirm","e","value"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport { API, Storage } from \"aws-amplify\";\nimport { onError } from \"../libs/errorLib\";\nimport Form from \"react-bootstrap/Form\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport config from \"../config\";\nimport \"./Notes.css\";\n\nexport default function Notes() {\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const file = useRef(null);\n  const { id } = useParams();\n  const history = useHistory();\n  const [note, setNote] = useState(null);\n  const [content, setContent] = useState(\"\");\n\n  useEffect(() => {\n    function loadNote() {\n      return API.get(\"notes\", `/notes/${id}`);\n    }\n\n    async function onLoad() {\n      try {\n        const note = await loadNote();\n        const { content, attachment } = note;\n\n        if (attachment) {\n          note.attachmentURL = await Storage.vault.get(attachment);\n        }\n\n        setContent(content);\n        setNote(note);\n      } catch (e) {\n        onError(e);\n      }\n    }\n\n    onLoad();\n  }, [id]);\n\nfunction validateForm() {\n  return content.length > 0;\n}\n\nfunction formatFilename(str) {\n  return str.replace(/^\\w+-/, \"\");\n}\n\nfunction handleFileChange(event) {\n  file.current = event.target.files[0];\n}\n\nasync function handleSubmit(event) {\n  let attachment;\n\n  event.preventDefault();\n\n  if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n    alert(\n      `Please pick a file smaller than ${config.MAX_ATTACHMENT_SIZE /\n        1000000} MB.`\n    );\n    return;\n  }\n\n  setIsLoading(true);\n}\n\nasync function handleDelete(event) {\n  event.preventDefault();\n\n  const confirmed = window.confirm(\n    \"Are you sure you want to delete this note?\"\n  );\n\n  if (!confirmed) {\n    return;\n  }\n\n  setIsDeleting(true);\n}\n\nreturn (\n  <div className=\"Notes\">\n    {note && (\n      <Form onSubmit={handleSubmit}>\n        <Form.Group controlId=\"content\">\n          <Form.Control\n            as=\"textarea\"\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n          />\n        </Form.Group>\n        <Form.Group controlId=\"file\">\n          <Form.Label>Attachment</Form.Label>\n          {note.attachment && (\n            <p>\n              <a\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                href={note.attachmentURL}\n              >\n                {formatFilename(note.attachment)}\n              </a>\n            </p>\n          )}\n          <Form.Control onChange={handleFileChange} type=\"file\" />\n        </Form.Group>\n        <LoaderButton\n          block\n          size=\"lg\"\n          type=\"submit\"\n          isLoading={isLoading}\n          disabled={!validateForm()}\n        >\n          Save\n        </LoaderButton>\n        <LoaderButton\n          block\n          size=\"lg\"\n          variant=\"danger\"\n          onClick={handleDelete}\n          isLoading={isDeleting}\n        >\n          Delete\n        </LoaderButton>\n      </Form>\n    )}\n  </div>\n);\n}"]},"metadata":{},"sourceType":"module"}