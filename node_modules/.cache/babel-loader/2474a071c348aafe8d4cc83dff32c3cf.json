{"ast":null,"code":"import _regeneratorRuntime from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import Form from\"react-bootstrap/Form\";import{useHistory}from\"react-router-dom\";import LoaderButton from\"../components/LoaderButton\";import{onError}from\"../libs/errorLib\";import config from\"../config\";import\"./NewNote.css\";import{API}from\"aws-amplify\";import{s3Upload}from\"../libs/awsLib\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function NewNote(){var file=useRef(null);var history=useHistory();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),content=_useState2[0],setContent=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];function validateForm(){return content.length>0;}function handleFileChange(event){file.current=event.target.files[0];}function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var attachment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(file.current&&file.current.size>config.MAX_ATTACHMENT_SIZE)){_context.next=4;break;}alert(\"Please pick a file smaller than \".concat(config.MAX_ATTACHMENT_SIZE/1000000,\" MB.\"));return _context.abrupt(\"return\");case 4:setIsLoading(true);_context.prev=5;if(!file.current){_context.next=12;break;}_context.next=9;return s3Upload(file.current);case 9:_context.t0=_context.sent;_context.next=13;break;case 12:_context.t0=null;case 13:attachment=_context.t0;_context.next=16;return createNote({content:content,attachment:attachment});case 16:history.push(\"/\");_context.next=23;break;case 19:_context.prev=19;_context.t1=_context[\"catch\"](5);onError(_context.t1);setIsLoading(false);case 23:case\"end\":return _context.stop();}}},_callee,null,[[5,19]]);}));return _handleSubmit.apply(this,arguments);}function createNote(note){return API.post(\"notes\",\"/notes\",{body:note});}return/*#__PURE__*/_jsx(\"div\",{className:\"NewNote\",children:/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(Form.Group,{controlId:\"content\",children:/*#__PURE__*/_jsx(Form.Control,{value:content,as:\"textarea\",onChange:function onChange(e){return setContent(e.target.value);}})}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"file\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Attachment\"}),/*#__PURE__*/_jsx(Form.Control,{onChange:handleFileChange,type:\"file\"})]}),/*#__PURE__*/_jsx(LoaderButton,{block:true,type:\"submit\",size:\"lg\",variant:\"primary\",isLoading:isLoading,disabled:!validateForm(),children:\"Create\"})]})});}","map":{"version":3,"sources":["/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/src/containers/NewNote.js"],"names":["React","useRef","useState","Form","useHistory","LoaderButton","onError","config","API","s3Upload","NewNote","file","history","content","setContent","isLoading","setIsLoading","validateForm","length","handleFileChange","event","current","target","files","handleSubmit","preventDefault","size","MAX_ATTACHMENT_SIZE","alert","attachment","createNote","push","note","post","body","e","value"],"mappings":"meAAA,MAAOA,CAAAA,KAAP,EAAgBC,MAAhB,CAAwBC,QAAxB,KAAwC,OAAxC,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,YAAP,KAAyB,4BAAzB,CACA,OAASC,OAAT,KAAwB,kBAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CACA,MAAO,eAAP,CACA,OAASC,GAAT,KAAoB,aAApB,CACA,OAASC,QAAT,KAAyB,gBAAzB,C,wFAGA,cAAe,SAASC,CAAAA,OAAT,EAAmB,CAChC,GAAMC,CAAAA,IAAI,CAAGV,MAAM,CAAC,IAAD,CAAnB,CACA,GAAMW,CAAAA,OAAO,CAAGR,UAAU,EAA1B,CAFgC,cAGFF,QAAQ,CAAC,EAAD,CAHN,wCAGzBW,OAHyB,eAGhBC,UAHgB,8BAIEZ,QAAQ,CAAC,KAAD,CAJV,yCAIzBa,SAJyB,eAIdC,YAJc,eAMhC,QAASC,CAAAA,YAAT,EAAwB,CACtB,MAAOJ,CAAAA,OAAO,CAACK,MAAR,CAAiB,CAAxB,CACD,CAED,QAASC,CAAAA,gBAAT,CAA0BC,KAA1B,CAAiC,CAC/BT,IAAI,CAACU,OAAL,CAAeD,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAf,CACD,CAZ+B,QAcjBC,CAAAA,YAdiB,gJAchC,iBAA4BJ,KAA5B,iIACAA,KAAK,CAACK,cAAN,GADA,KAGId,IAAI,CAACU,OAAL,EAAgBV,IAAI,CAACU,OAAL,CAAaK,IAAb,CAAoBnB,MAAM,CAACoB,mBAH/C,0BAIEC,KAAK,2CAEDrB,MAAM,CAACoB,mBAAP,CAA6B,OAF5B,SAAL,CAJF,wCAYAX,YAAY,CAAC,IAAD,CAAZ,CAZA,oBAeqBL,IAAI,CAACU,OAf1B,gDAe0CZ,CAAAA,QAAQ,CAACE,IAAI,CAACU,OAAN,CAflD,6EAemE,IAfnE,SAeQQ,UAfR,oCAiBQC,CAAAA,UAAU,CAAC,CAAEjB,OAAO,CAAPA,OAAF,CAAWgB,UAAU,CAAVA,UAAX,CAAD,CAjBlB,SAkBEjB,OAAO,CAACmB,IAAR,CAAa,GAAb,EAlBF,iFAoBEzB,OAAO,aAAP,CACAU,YAAY,CAAC,KAAD,CAAZ,CArBF,qEAdgC,+CAwClC,QAASc,CAAAA,UAAT,CAAoBE,IAApB,CAA0B,CACxB,MAAOxB,CAAAA,GAAG,CAACyB,IAAJ,CAAS,OAAT,CAAkB,QAAlB,CAA4B,CACjCC,IAAI,CAAEF,IAD2B,CAA5B,CAAP,CAGD,CAEC,mBACE,YAAK,SAAS,CAAC,SAAf,uBACE,MAAC,IAAD,EAAM,QAAQ,CAAER,YAAhB,wBACE,KAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,SAAtB,uBACE,KAAC,IAAD,CAAM,OAAN,EACE,KAAK,CAAEX,OADT,CAEE,EAAE,CAAC,UAFL,CAGE,QAAQ,CAAE,kBAACsB,CAAD,QAAOrB,CAAAA,UAAU,CAACqB,CAAC,CAACb,MAAF,CAASc,KAAV,CAAjB,EAHZ,EADF,EADF,cAQE,MAAC,IAAD,CAAM,KAAN,EAAY,SAAS,CAAC,MAAtB,wBACE,KAAC,IAAD,CAAM,KAAN,yBADF,cAEE,KAAC,IAAD,CAAM,OAAN,EAAc,QAAQ,CAAEjB,gBAAxB,CAA0C,IAAI,CAAC,MAA/C,EAFF,GARF,cAYE,KAAC,YAAD,EACE,KAAK,KADP,CAEE,IAAI,CAAC,QAFP,CAGE,IAAI,CAAC,IAHP,CAIE,OAAO,CAAC,SAJV,CAKE,SAAS,CAAEJ,SALb,CAME,QAAQ,CAAE,CAACE,YAAY,EANzB,oBAZF,GADF,EADF,CA2BD","sourcesContent":["import React, { useRef, useState } from \"react\";\nimport Form from \"react-bootstrap/Form\";\nimport { useHistory } from \"react-router-dom\";\nimport LoaderButton from \"../components/LoaderButton\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport \"./NewNote.css\";\nimport { API } from \"aws-amplify\";\nimport { s3Upload } from \"../libs/awsLib\";\n\n\nexport default function NewNote() {\n  const file = useRef(null);\n  const history = useHistory();\n  const [content, setContent] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  function validateForm() {\n    return content.length > 0;\n  }\n\n  function handleFileChange(event) {\n    file.current = event.target.files[0];\n  }\n\n  async function handleSubmit(event) {\n  event.preventDefault();\n\n  if (file.current && file.current.size > config.MAX_ATTACHMENT_SIZE) {\n    alert(\n      `Please pick a file smaller than ${\n        config.MAX_ATTACHMENT_SIZE / 1000000\n      } MB.`\n    );\n    return;\n  }\n\n  setIsLoading(true);\n\n  try {\n    const attachment = file.current ? await s3Upload(file.current) : null;\n\n    await createNote({ content, attachment });\n    history.push(\"/\");\n  } catch (e) {\n    onError(e);\n    setIsLoading(false);\n  }\n}\n\n\nfunction createNote(note) {\n  return API.post(\"notes\", \"/notes\", {\n    body: note\n  });\n}\n\n  return (\n    <div className=\"NewNote\">\n      <Form onSubmit={handleSubmit}>\n        <Form.Group controlId=\"content\">\n          <Form.Control\n            value={content}\n            as=\"textarea\"\n            onChange={(e) => setContent(e.target.value)}\n          />\n        </Form.Group>\n        <Form.Group controlId=\"file\">\n          <Form.Label>Attachment</Form.Label>\n          <Form.Control onChange={handleFileChange} type=\"file\" />\n        </Form.Group>\n        <LoaderButton\n          block\n          type=\"submit\"\n          size=\"lg\"\n          variant=\"primary\"\n          isLoading={isLoading}\n          disabled={!validateForm()}\n        >\n          Create\n        </LoaderButton>\n      </Form>\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}