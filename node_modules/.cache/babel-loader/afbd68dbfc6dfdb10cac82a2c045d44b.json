{"ast":null,"code":"import _regeneratorRuntime from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{API}from\"aws-amplify\";import{useHistory}from\"react-router-dom\";import{onError}from\"../libs/errorLib\";import config from\"../config\";import{Elements,StripeProvider}from\"react-stripe-elements\";import BillingForm from\"../components/BillingForm\";import\"./Settings.css\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function Settings(){var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),stripe=_useState4[0],setStripe=_useState4[1];useEffect(function(){setStripe(window.Stripe(config.STRIPE_KEY));},[]);function billUser(details){return API.post(\"notes\",\"/billing\",{body:details});}function handleFormSubmit(_x,_x2){return _handleFormSubmit.apply(this,arguments);}function _handleFormSubmit(){_handleFormSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(storage,_ref){var token,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=_ref.token,error=_ref.error;if(!error){_context.next=4;break;}onError(error);return _context.abrupt(\"return\");case 4:setIsLoading(true);_context.prev=5;_context.next=8;return billUser({storage:storage,source:token.id});case 8:alert(\"Your card has been charged successfully!\");history.push(\"/\");_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](5);onError(_context.t0);setIsLoading(false);case 16:case\"end\":return _context.stop();}}},_callee,null,[[5,12]]);}));return _handleFormSubmit.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"Settings\",children:/*#__PURE__*/_jsx(StripeProvider,{stripe:stripe,children:/*#__PURE__*/_jsx(Elements,{fonts:[{cssSrc:\"https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800\"}],children:/*#__PURE__*/_jsx(BillingForm,{isLoading:isLoading,onSubmit:handleFormSubmit})})})});}","map":{"version":3,"sources":["/Users/linyue/Documents/amanda/spring2021/cloud_special_topics/notes-app-client/src/containers/Settings.js"],"names":["React","useState","useEffect","API","useHistory","onError","config","Elements","StripeProvider","BillingForm","Settings","history","isLoading","setIsLoading","stripe","setStripe","window","Stripe","STRIPE_KEY","billUser","details","post","body","handleFormSubmit","storage","token","error","source","id","alert","push","cssSrc"],"mappings":"meAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,GAAT,KAAoB,aAApB,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,OAAT,KAAwB,kBAAxB,CACA,MAAOC,CAAAA,MAAP,KAAmB,WAAnB,CACA,OAASC,QAAT,CAAmBC,cAAnB,KAAyC,uBAAzC,CACA,MAAOC,CAAAA,WAAP,KAAwB,2BAAxB,CACA,MAAO,gBAAP,C,2CAEA,cAAe,SAASC,CAAAA,QAAT,EAAoB,CACjC,GAAMC,CAAAA,OAAO,CAAGP,UAAU,EAA1B,CADiC,cAECH,QAAQ,CAAC,KAAD,CAFT,wCAE1BW,SAF0B,eAEfC,YAFe,8BAGLZ,QAAQ,CAAC,IAAD,CAHH,yCAG1Ba,MAH0B,eAGlBC,SAHkB,eAKjCb,SAAS,CAAC,UAAM,CACda,SAAS,CAACC,MAAM,CAACC,MAAP,CAAcX,MAAM,CAACY,UAArB,CAAD,CAAT,CACD,CAFQ,CAEN,EAFM,CAAT,CAIA,QAASC,CAAAA,QAAT,CAAkBC,OAAlB,CAA2B,CACzB,MAAOjB,CAAAA,GAAG,CAACkB,IAAJ,CAAS,OAAT,CAAkB,UAAlB,CAA8B,CACnCC,IAAI,CAAEF,OAD6B,CAA9B,CAAP,CAGD,CAbgC,QAelBG,CAAAA,gBAfkB,gKAejC,iBAAgCC,OAAhC,uIAA2CC,KAA3C,MAA2CA,KAA3C,CAAkDC,KAAlD,MAAkDA,KAAlD,KACIA,KADJ,yBAEErB,OAAO,CAACqB,KAAD,CAAP,CAFF,wCAMAb,YAAY,CAAC,IAAD,CAAZ,CANA,sCASQM,CAAAA,QAAQ,CAAC,CACbK,OAAO,CAAPA,OADa,CAEbG,MAAM,CAAEF,KAAK,CAACG,EAFD,CAAD,CAThB,QAcEC,KAAK,CAAC,0CAAD,CAAL,CACAlB,OAAO,CAACmB,IAAR,CAAa,GAAb,EAfF,iFAiBEzB,OAAO,aAAP,CACAQ,YAAY,CAAC,KAAD,CAAZ,CAlBF,qEAfiC,mDAqCnC,mBACE,YAAK,SAAS,CAAC,UAAf,uBACE,KAAC,cAAD,EAAgB,MAAM,CAAEC,MAAxB,uBACE,KAAC,QAAD,EACE,KAAK,CAAE,CACL,CACEiB,MAAM,CACJ,uEAFJ,CADK,CADT,uBAQE,KAAC,WAAD,EAAa,SAAS,CAAEnB,SAAxB,CAAmC,QAAQ,CAAEW,gBAA7C,EARF,EADF,EADF,EADF,CAgBC","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { API } from \"aws-amplify\";\nimport { useHistory } from \"react-router-dom\";\nimport { onError } from \"../libs/errorLib\";\nimport config from \"../config\";\nimport { Elements, StripeProvider } from \"react-stripe-elements\";\nimport BillingForm from \"../components/BillingForm\";\nimport \"./Settings.css\";\n\nexport default function Settings() {\n  const history = useHistory();\n  const [isLoading, setIsLoading] = useState(false);\n  const [stripe, setStripe] = useState(null);\n\n  useEffect(() => {\n    setStripe(window.Stripe(config.STRIPE_KEY));\n  }, []);\n\n  function billUser(details) {\n    return API.post(\"notes\", \"/billing\", {\n      body: details\n    });\n  }\n\n  async function handleFormSubmit(storage, { token, error }) {\n  if (error) {\n    onError(error);\n    return;\n  }\n\n  setIsLoading(true);\n\n  try {\n    await billUser({\n      storage,\n      source: token.id\n    });\n\n    alert(\"Your card has been charged successfully!\");\n    history.push(\"/\");\n  } catch (e) {\n    onError(e);\n    setIsLoading(false);\n  }\n}\n\nreturn (\n  <div className=\"Settings\">\n    <StripeProvider stripe={stripe}>\n      <Elements\n        fonts={[\n          {\n            cssSrc:\n              \"https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800\",\n          },\n        ]}\n      >\n        <BillingForm isLoading={isLoading} onSubmit={handleFormSubmit} />\n      </Elements>\n    </StripeProvider>\n  </div>\n);\n}"]},"metadata":{},"sourceType":"module"}